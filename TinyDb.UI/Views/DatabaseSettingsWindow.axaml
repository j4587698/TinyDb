<suki:SukiWindow xmlns="https://github.com/avaloniaui"
            xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
            xmlns:vm="using:TinyDb.UI.ViewModels"
            xmlns:suki="clr-namespace:SukiUI.Controls;assembly=SukiUI"
            xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
            xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
            mc:Ignorable="d" d:DesignWidth="500" d:DesignHeight="550"
            x:Class="TinyDb.UI.Views.DatabaseSettingsWindow"
            x:DataType="vm:DatabaseSettingsViewModel"
            Title="数据库设置" Width="550" Height="600"
            WindowStartupLocation="CenterOwner">

    <Design.DataContext>
        <vm:DatabaseSettingsViewModel/>
    </Design.DataContext>

    <Grid RowDefinitions="Auto,*,Auto" Margin="20">
        <!-- 标题 -->
        <TextBlock Grid.Row="0" Text="数据库配置" FontSize="20" FontWeight="Bold"
                   Margin="0,0,0,20" HorizontalAlignment="Center"/>

        <!-- 设置内容 -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel Spacing="15">
                <!-- WAL设置区域 -->
                <suki:GlassCard>
                    <StackPanel Spacing="15">
                        <TextBlock Text="WAL (Write-Ahead Logging)"
                                   FontWeight="Bold" FontSize="14"/>

                        <ToggleSwitch Content="启用日志记录" 
                                      IsChecked="{Binding EnableWal}" />

                        <StackPanel IsEnabled="{Binding EnableWal}" Spacing="10">
                            <TextBlock Text="文件名格式:"/>
                            <TextBox Text="{Binding WalFileNameFormat}"
                                     Watermark="name-wal.ext"/>
                            <TextBlock Text="可用占位符: {name} - 数据库名称, {ext} - 扩展名"
                                       FontSize="11" Opacity="0.6"/>

                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <Button Classes="Basic" Content="默认格式" Command="{Binding SetDefaultFormatCommand}"/>
                                <Button Classes="Basic" Content="兼容模式" Command="{Binding SetLegacyFormatCommand}"/>
                            </StackPanel>

                            <Border Background="{DynamicResource SukiBackground}" CornerRadius="4" Padding="10">
                                <StackPanel Spacing="5">
                                    <TextBlock Text="预览:" FontSize="12" FontWeight="Bold"/>
                                    <TextBlock Text="{Binding WalFileNamePreview}"
                                               FontFamily="Consolas" FontSize="11"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </StackPanel>
                </suki:GlassCard>

                <!-- 其他设置区域 -->
                <suki:GlassCard>
                    <StackPanel Spacing="15">
                        <TextBlock Text="高级设置" FontWeight="Bold" FontSize="14"/>

                        <CheckBox Content="只读模式 (Read-Only)"
                                  IsChecked="{Binding ReadOnly}"/>

                        <StackPanel Spacing="5">
                            <TextBlock Text="页面大小 (KB):"/>
                            <NumericUpDown Value="{Binding PageSizeKb}"
                                          Minimum="1" Maximum="1024" Increment="1"/>
                            <TextBlock Text="较大的页面大小可能提高大数据量的性能"
                                       FontSize="11" Opacity="0.6"/>
                        </StackPanel>
                    </StackPanel>
                </suki:GlassCard>
            </StackPanel>
        </ScrollViewer>

        <!-- 按钮区域 -->
        <Grid Grid.Row="2" ColumnDefinitions="*,Auto,Auto" Margin="0,20,0,0">
            <TextBlock Grid.Column="0" Text="{Binding StatusMessage}"
                       VerticalAlignment="Center" Opacity="0.7"/>
            <Button Grid.Column="1" Content="取消" Classes="Basic"
                    Command="{Binding CancelCommand}"
                    Margin="10,0,5,0"/>
            <Button Grid.Column="2" Content="保存" Classes="Primary"
                    Command="{Binding SaveCommand}"
                    Margin="5,0,0,0"/>
        </Grid>
    </Grid>
</suki:SukiWindow>
